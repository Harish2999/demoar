<!DOCTYPE html>
<html>
  <head>
    <title>Geolocation AR Example</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
  </head>
  <body>
    <a-scene embedded arjs>
      <a-camera gps-camera rotation-reader></a-camera>
      <a-entity id="model" gltf-model="url(./assets/tesla/scene.gltf)"></a-entity>
    </a-scene>
    <script>
      AFRAME.registerComponent('gps-entity-place', {
        init: function() {
          this.onLoaded = this.onLoaded.bind(this);
        },
        update: function() {
          const { latitude, longitude } = this.el.sceneEl.components['gps-camera'].data;
          if (!latitude || !longitude) return;

          const { x, y, z } = this.el.getAttribute('position');
          const position = { lat: latitude, lng: longitude, alt: 0 };
          const orientation = { x: 0, y: this.el.sceneEl.camera.el.object3D.rotation.y, z: 0 };
          const distance = AFRAME.THREE.Math.distanceToVector3(position, { x, y, z });
          const angle = AFRAME.THREE.Math.radToDeg(Math.atan2(position.lng - longitude, position.lat - latitude));

          this.el.setAttribute('position', { x: distance * Math.sin(angle), y: 0, z: distance * Math.cos(angle) });
          this.el.setAttribute('gps-entity-place-added', '');
          this.el.setAttribute('rotation', orientation);
          this.el.addEventListener('model-loaded', this.onLoaded);
        },
        onLoaded: function(e) {
          const { position } = this.el.object3D;
          const { latitude, longitude } = this.el.sceneEl.components['gps-camera'].data;
          const distance = AFRAME.THREE.Math.distanceToVector3({ lat: latitude, lng: longitude, alt: 0 }, { x: position.x, y: position.y, z: position.z });
          this.el.setAttribute('position', { x: position.x, y: distance, z: position.z });
        }
      });
    </script>
  </body>
</html>